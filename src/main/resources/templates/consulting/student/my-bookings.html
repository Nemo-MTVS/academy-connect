<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layout :: html(~{::title}, ~{::link}, ~{::section}, ~{::script})}">
<head>
    <title>내 예약 보기</title>
    <link th:href="@{/css/consulting.css}" rel="stylesheet">
</head>
<body>
<section>
    <div class="container mt-4">
        <!-- 탭 메뉴 -->
        <ul class="nav nav-tabs mb-4">
            <li class="nav-item">
                <a class="nav-link" th:classappend="${activeTab == 'upcoming' ? 'active' : ''}" 
                   th:href="@{/student/consulting-my-bookings?view=upcoming}">예정된 예약</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" th:classappend="${activeTab == 'past' ? 'active' : ''}" 
                   th:href="@{/student/consulting-my-bookings?view=past}">지난 예약</a>
            </li>
        </ul>

        <!-- 예약 목록 -->
        <div th:if="${bookings != null && !bookings.isEmpty()}" class="row">
            <div class="col-md-4 mb-3" th:each="booking : ${bookings}">
                <div class="card booking-card">
                    <div class="card-body">
                        <div class="d-flex justify-content-between booking-header">
                            <div>
                                <h5 class="instructor-name" th:text="${booking.instructorName + ' 강사'}">강사명</h5>
                            </div>
                            <span th:class="${booking.statusClass}" th:text="${booking.status}">상태</span>
                        </div>
                        
                        <p class="message-text" th:text="${booking.safeMessage}">상담 메시지</p>
                        
                        <div class="d-flex justify-content-between align-items-center mt-3">
                            <div class="time-info">
                                <div>날짜: <span th:text="${booking.formattedStartTime}">2025/04/30</span></div>
                                <div>시간: <span th:text="${booking.formattedStartTimeOnly + ' - ' + booking.formattedEndTimeOnly}">11:00 - 12:00</span></div>
                            </div>
                            
                            <div th:if="${booking.cancellable}">
                                <form th:action="@{/student/consulting-bookings/{id}/cancel(id=${booking.id})}" method="post" 
                                      onsubmit="return confirm('예약을 취소하시겠습니까?');">
                                    <button type="submit" class="btn btn-sm btn-cancel">예약 취소하기</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 예약이 없을 경우 -->
        <div th:if="${bookings != null && bookings.isEmpty()}" class="empty-state">
            <div class="text-center py-5">
                <img src="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/icons/calendar-x.svg" alt="No bookings" width="64" height="64">
                <h4 class="mt-3" th:text="${activeTab == 'upcoming' ? '예정된 예약이 없습니다.' : '지난 예약이 없습니다.'}">예약 없음</h4>
                <p class="text-muted" th:text="${activeTab == 'upcoming' ? '상담 예약을 통해 강사님과 1:1 대화를 나눠보세요!' : '상담 내역이 여기에 기록됩니다.'}">안내 메시지</p>
                <a th:if="${activeTab == 'upcoming'}" th:href="@{/student/consulting-booking}" class="btn btn-primary mt-2">예약하기</a>
            </div>
        </div>
    </div>
</section>

<script>
    // 성공 알림 토스트
    document.addEventListener('DOMContentLoaded', function() {
        var urlParams = new URLSearchParams(window.location.search);
        if (urlParams.has('success')) {
            // Bootstrap toast 초기화 및 표시 로직
            var toastEl = document.createElement('div');
            toastEl.className = 'toast align-items-center text-white bg-success border-0 position-fixed bottom-0 end-0 m-3';
            toastEl.setAttribute('role', 'alert');
            toastEl.setAttribute('aria-live', 'assertive');
            toastEl.setAttribute('aria-atomic', 'true');
            toastEl.innerHTML = `
                <div class="d-flex">
                    <div class="toast-body">
                        예약이 성공적으로 취소되었습니다.
                    </div>
                    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
                </div>
            `;
            document.body.appendChild(toastEl);
            
            var toast = new bootstrap.Toast(toastEl, {
                animation: true,
                autohide: true,
                delay: 3000
            });
            toast.show();
        }
    });
</script>
</body>
</html>